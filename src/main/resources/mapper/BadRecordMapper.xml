<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.luoying.apartment.dao.BadRecordMapper">
    <select id="queryBadRecordPage" parameterType="java.util.Map" resultType="com.luoying.apartment.pojo.BadRecord">
        select  tbr.*,ts.student_name,td.dormitory_num,td.building,tu.username as record_user_name,tu2.username as handle_user_name
        from tb_bad_record tbr
        left join tb_student ts on tbr.student_id = ts.id
        left join tb_dormitory td on tbr.dormitory_id = td.id
        left join tb_user tu on tbr.record_user_id = tu.id
        left join tb_user tu2  on tbr.handle_user_id = tu2.id
        where 1=1
        <if test="studentName!=null and studentName !=''">
            and ts.student_name = #{studentName}
        </if>
        <if test="recordUserName!=null and recordUserName!=''">
            and tu.username = #{recordUserName}
        </if>
        <if test="handleUserName!=null and handleUserName!=''">
            and tu2.username = #{handleUserName}
        </if>
        <if test="dormitoryId!=null and dormitoryId!=''">
            and tbr.dormitory_id =#{dormitoryId}
        </if>
        <if test="dormitoryNum!=null and dormitoryNum != '' ">
            and  td.dormitory_num=#{dormitoryNum}
        </if>
        <if test="building!=null and building != '' ">
            and   td.building =#{building}
        </if>
        order by tbr.create_date desc
        limit #{beginIndex},#{limit}
    </select>
    <select id="queryBadRecordCount" parameterType="java.util.Map" resultType="int">
        select  count(*)
        from tb_bad_record tbr
        left join tb_student ts on tbr.student_id = ts.id
        left join tb_dormitory td on tbr.dormitory_id = td.id
        left join tb_user tu on tbr.record_user_id = tu.id
        left join tb_user tu2  on tbr.handle_user_id = tu2.id
        where 1=1
        <if test="studentName!=null and studentName !=''">
            and ts.student_name = #{studentName}
        </if>
        <if test="recordUserName!=null and recordUserName!=''">
            and tu.username = #{recordUserName}
        </if>
        <if test="handleUserName!=null and handleUserName!=''">
            and tu2.username = #{handleUserName}
        </if>
        <if test="dormitoryId!=null and dormitoryId!=''">
            and tbr.dormitory_id =#{dormitoryId}
        </if>
        <if test="dormitoryNum!=null and dormitoryNum != '' ">
            and  td.dormitory_num=#{dormitoryNum}
        </if>
        <if test="building!=null and building != '' ">
            and   td.building =#{building}
        </if>
    </select>
    <select id="queryBadRecordById" parameterType="Long" resultType="com.luoying.apartment.pojo.BadRecord">
        select  tbr.*,ts.student_name,td.dormitory_num,td.building,tu.username as record_user_name,tu2.username as handle_user_name
        from tb_bad_record tbr
        left join tb_student ts on tbr.student_id = ts.id
        left join tb_dormitory td on tbr.dormitory_id = td.id
        left join tb_user tu on tbr.record_user_id = tu.id
        left join tb_user tu2  on tbr.handle_user_id = tu2.id
        where tbr.id = #{id}
    </select>
</mapper>
